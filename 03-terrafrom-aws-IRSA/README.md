## AWS EKS with IRSA {Iam Roles for Service Accounts}

This demo will show the working of the IRSA in AWS EKS. IRSA Stands for Iam Roles for Servvice Accounts. EKS cluster by default act as a OIDC (open id connect provider) which means we can use our EKS clusters to access/use AWS services. When we create EKS cluster we get a OIDC issuer URL which we can use to create our EKS cluster a OIDC provider. First we need to create a EKS CLuster and all  files are present in `01-eks-cluster` directory. We are creating our own vpc resources and a eks cluster with a public node group. In `19-iam-oidc-eks.tf` file, we are creating eks as a OIDC provider. And in this resource's arguments we are using URL - which is the OIDC url , client_id_list - this is audience which  means what service our eks oidc will authenticate with first and for audience we are using AWS STS service. I am also using here the datasource aws_partition , this will help us to get the name of the service url in which terraform is working (amazomaws.com)  and thumbprint_list - this is the ca token for EKS service whose value is by default available to us for year 2037 & this thumbprint is provided the aws service eks. When configuring the OIDC provider for your EKS cluster, you typically need to provide the EKS OIDC root CA thumbprint to validate the certificate presented by the OIDC provider. This thumbprint ensures that the certificate presented during authentication matches the expected certificate, preventing unauthorized access.



In Directory `02-k8s-resources` we are using Datasource Remote State to use some outputs as input from `01-eks-cluster` . Also we are creating a IAM role and policy  which have aws s3 read only access and we are attaching this role to OIDC provider which we created in `01-eks-cluster` and  service account which we also creating in this demo. The whole purpose of this demo is that we are creating a kubernetes job which will have read only access to our aws s3 buckets.And this access is leveraged by using Iam Roles For Service Accounts. After creating all the resources , when you check the logs of the job's pod , you will see that allthe s3 buckets will listed there in logs..

